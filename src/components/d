function doPost(e) { try { var body = JSON.parse(e.postData.contents); var records = body.records || []; if (records.length === 0) { throw new Error("Nenhum registro enviado"); } var ss = SpreadsheetApp.getActiveSpreadsheet(); var sheet = ss.getSheetByName("Respostas"); records.forEach(rec => { var row = [ new Date(), // Data de recebimento rec.tecnico || "", // Técnico rec.data || "", // Data serviço rec.tipo || "", // Tipo rec.placa || "", // Placa rec.chassi || "", // Chassi rec.cliente || "", // Cliente rec.valor || "", // Valor rec.telefone || "", // Telefone rec.email || "" // Email ]; sheet.appendRow(row); // ----------------------------- // ENVIO DE EMAIL // ----------------------------- var destinatario = rec.email || "gabriel.barbosa@scopetechnology.com"; var assunto = "Serviço registrado com sucesso"; var mensagem = "Olá " + (rec.cliente || "") + ",\n\n" + "Seu serviço foi registrado com os seguintes dados:\n\n" + "Data do serviço: " + (rec.data || "") + "\n" + "Tipo: " + (rec.tipo || "") + "\n" + "Placa: " + (rec.placa || "") + "\n" + "Chassi: " + (rec.chassi || "") + "\n" + "Valor: " + (rec.valor || "") + "\n\n" + "Obrigado!"; MailApp.sendEmail(destinatario, assunto, mensagem); }); return ContentService .createTextOutput(JSON.stringify({ status: "ok", registros: records.length })) .setMimeType(ContentService.MimeType.JSON); } catch (err) { return ContentService .createTextOutput(JSON.stringify({ status: "error", error: err.toString() })) .setMimeType(ContentService.MimeType.JSON); } }